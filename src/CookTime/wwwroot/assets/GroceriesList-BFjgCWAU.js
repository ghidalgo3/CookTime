import{r as g,j as i,w as p}from"./chunk-EPOLDU6W-43oXRp_d.js";import{W as f}from"./index.module-DKd-uFxg.js";import{T as v,I as R,v as C}from"./todaysTenDisplay-BIIdUU_S.js";import{R as u,C as o,B as l}from"./Row-Ce-ZerzP.js";import{F as h}from"./Form-DuBjGd-t.js";import{u as j}from"./useTitle-Da5jpf3t.js";import"./browser-DefK9-wN.js";import"./index-Dd5FJs2U.js";import"./ThemeProvider-CkrZYoIe.js";class q extends g.Component{constructor(t){super(t),this.state={cart:{id:"",CreateAt:"",recipeRequirement:[],active:!0,ingredientState:[],dietDetails:[]}}}todaysTen(){let t=this.state.cart.dietDetails.find(n=>n.name==="TodaysTen");return t!=null?i.jsx(v,{todaysTen:t}):null}componentDidMount(){fetch("/api/cart").then(t=>t.json()).then(t=>{let n=t;n.ingredientState=n.ingredientState.filter(e=>e.ingredient!==null),this.setState({cart:n})})}onDeleteRecipe=t=>{var n={...this.state.cart,recipeRequirement:this.state.cart.recipeRequirement.filter((e,a)=>a!==t)};this.setState({cart:n}),this.PutCart(n)};PutCart=t=>{fetch(`api/Cart/${this.state.cart.id}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})};render(){let t=this.state.cart?.recipeRequirement.map((e,a)=>{let r=e.recipe??e.multiPartRecipe;return i.jsx(u,{className:"align-items-center padding-left-0 margin-top-10",children:i.jsxs(o,{className:"col d-flex align-items-center",children:[i.jsxs("div",{className:"serving-counter-in-cart",children:[i.jsx(l,{variant:"danger",className:"minus-counter-button",onClick:s=>{Array.from(this.state.cart.recipeRequirement)[a].quantity>0&&this.addToRecipeRequirement(a,-1)},children:i.jsx("i",{className:"bi bi-dash"})}),i.jsx(h.Control,{onChange:s=>{s.target.value===""&&this.setRecipeRequirement(a,0);let c=parseFloat(s.target.value);!Number.isNaN(c)&&c>0&&this.setRecipeRequirement(a,c)},className:"form-control count",value:Math.round(e.quantity*r.servingsProduced)}),i.jsx(l,{variant:"success",className:"plus-counter-button",onClick:s=>this.addToRecipeRequirement(a,1),children:i.jsx("i",{className:"bi bi-plus"})})]}),i.jsx("div",{id:"cart-recipe-item",className:"form-control input-field-style margin-left-20 margin-right-10 do-not-overflow-text",children:i.jsx("a",{href:`/Recipes/Details?id=${r.id}&servings=${e.quantity*r.servingsProduced}`,children:r.name})},r.id),i.jsx(l,{className:"float-end height-38",variant:"danger",onClick:s=>this.onDeleteRecipe(a),children:i.jsx("i",{className:"bi bi-trash"})})]})},a)}),n=this.getAggregateIngredients();return i.jsxs(h,{children:[i.jsxs(u,{children:[i.jsx(o,{className:"justify-content-md-left",xs:6,children:i.jsx("h1",{className:"margin-bottom-20",children:"Groceries List"})}),i.jsx(o,{children:i.jsx(l,{variant:"danger",className:"float-end",onClick:e=>this.onClear(),children:"Clear Cart"})})]}),this.todaysTen(),i.jsx("div",{className:"cart-header",children:"Servings"}),i.jsx("div",{children:t}),i.jsx("div",{className:"cart-header margin-top-15",children:"Ingredients"}),i.jsx("div",{children:n})]})}addToRecipeRequirement(t,n){var e=Array.from(this.state.cart.recipeRequirement);let a=e[t].recipe?.servingsProduced??e[t].multiPartRecipe.servingsProduced;if(e[t].quantity+=n/a,e[t].quantity>0){let r={...this.state.cart,recipeRequirement:e};this.setState({cart:r}),this.PutCart(r)}else console.log(e[t].quantity)}setRecipeRequirement(t,n){var e=Array.from(this.state.cart.recipeRequirement);let a=e[t].recipe?.servingsProduced??e[t].multiPartRecipe.servingsProduced;e[t].quantity=n/a;let r={...this.state.cart,recipeRequirement:e};this.setState({cart:r}),this.PutCart(r)}onClear(){fetch("/api/Cart/clear",{method:"POST"}).then(t=>{this.setState({cart:{...this.state.cart,recipeRequirement:[]}})})}getAggregateIngredients(){var t=this.state.cart?.recipeRequirement,n=t.flatMap((r,s)=>r.recipe!==null?r.recipe.ingredients.map((c,d)=>({...c,quantity:c.quantity*r.quantity})):r.multiPartRecipe.recipeComponents.flatMap(c=>c.ingredients.map((d,y)=>({...d,quantity:d.quantity*r.quantity})))),e=[];n.forEach(r=>{var s=e.findIndex((c,d)=>c.ingredient.id==r.ingredient.id&&c.unit==r.unit);s===-1?e.push(r):e[s].quantity+=r.quantity});var a=r=>!this.state.cart.ingredientState.some(s=>s.ingredient.id===r.ingredient.id);return e.sort((r,s)=>{let c=a(r),d=a(s);return c===d?0:c?-1:1}),e?.map(r=>{var s=a(r),c=s?()=>this.CheckIngredient(r):()=>this.UncheckIngredient(r);return i.jsxs("div",{onClick:d=>c(),className:"cart-ingredients-list",children:[s?i.jsx("i",{className:"bi bi-circle padding-right-10"}):i.jsx("i",{className:"bi bi-check-circle padding-right-10"}),i.jsx(R,{ingredientRequirement:r,strikethrough:!s})]})})}UncheckIngredient(t){if(this.state.cart.ingredientState.some(e=>e.ingredient.id===t.ingredient.id)){var n=this.state.cart.ingredientState.filter(a=>a.ingredient.id!==t.ingredient.id);let e={...this.state.cart,ingredientState:n};this.setState({cart:e}),this.PutCart(e)}}CheckIngredient(t){if(!this.state.cart.ingredientState.some(e=>e.ingredient.id===t.ingredient.id)){var n=Array.from(this.state.cart.ingredientState);n.push({id:C(),ingredient:t.ingredient,checked:!0});let e={...this.state.cart,ingredientState:n};this.setState({cart:e}),this.PutCart(e)}}}const x="Cart",_=p(function(){return j("Groceries List"),i.jsxs(i.Fragment,{children:[i.jsx(f,{children:i.jsx("link",{rel:"canonical",href:`${origin}/${x}`})}),i.jsx(q,{})]})});export{_ as default};
